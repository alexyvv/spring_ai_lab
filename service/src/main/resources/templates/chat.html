<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>
    <title th:text="${chat != null} ? 'Borisov GPT ‚Äî ' + chat.title : 'Borisov GPT'">Borisov GPT</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/chat.css}"/>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script defer th:src="@{/js/chat.js}"></script>
</head>
<body class="comic-body">
<div class="chat-container">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-top">
            <h1>Borisov GPT</h1>


            <!-- Chat list -->
            <div class="chat-list-wrapper">
                <ul class="chat-list">
                    <li th:each="c : ${chats}"
                        th:classappend="${chat != null and chat.id != null and c.id == chat.id} ? 'active' : ''">
                        <a th:href="@{/chat/{id}(id=${c.id})}">
                            <span th:text="${c.title}">–ß–∞—Ç</span>
                        </a>
                        <!-- –§–æ—Ä–º–∞ —É–¥–∞–ª–µ–Ω–∏—è —á–∞—Ç–∞ -->
                        <form th:action="@{/chat/{id}/delete(id=${c.id})}" method="post"
                              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —á–∞—Ç?');">
                            <button type="submit" class="delete-chat-btn">‚úï</button>
                        </form>
                    </li>
                </ul>
            </div>
        </div>

        <!-- New chat form -->
        <div class="sidebar-bottom">
            <form action="/chat/new" method="post" class="new-chat-form">
                <input type="text" name="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞" required/>
                <button type="submit" class="new-chat">üí• BOOM! –ù–æ–≤—ã–π —á–∞—Ç</button>
            </form>
        </div>
    </aside>

    <!-- Chat main section -->
    <main class="chat-main">

        <div class="messages" id="messages">
            <th:block th:if="${chat != null}">
                <!-- Debug: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ entries -->
                <div th:if="${#lists.isEmpty(chat.entries)}" style="display: none;">
                    <span th:text="'No entries found for chat ' + ${chat.id}"></span>
                </div>
                <div th:if="${!#lists.isEmpty(chat.entries)}" th:each="entry : ${chat.entries}"
                     th:class="${entry.role.name() eq 'USER'} ? 'message user' : 'message mentor'"><img
                        th:src="${entry.role.name() eq 'USER'} ? '/images/user.png' : '/images/mentor.png'" alt="avatar">
                    <div class="bubble" th:text="${entry.content}"></div>
                </div>
            </th:block>
        </div>

        <div th:if="${chat != null}">
            <form th:action="@{/chat/{chatId}/entry(chatId=${chat.id})}" method="post" class="input-area">
                <div class="input-bubble">
                    <label for="chat-input" class="sr-only">–°–ø—Ä–∞—à–∏–≤–∞–π</label>
                    <textarea id="chat-input" name="prompt" placeholder="–°–ø—Ä–∞—à–∏–≤–∞–π..." required></textarea>
                    <div class="button-group">
                        <button type="button" id="send-button" class="send-streaming">SEND RX</button>
                        <button type="submit" id="send-mvc-button" class="send-mvc">SEND MVC</button>
                    </div>
                </div>
            </form>
        </div>
    </main>
</div>
</body>
</html>
